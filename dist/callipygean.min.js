/*jshint nomen:false, browser: true, white: true, regexp:false, bitwise:false *//*global exports*//*!
 * callipygean
 * https://github.com/Couto/callipygean
 *
 * Copyright (c) 2012 Couto
 * Licensed under the MIT license.
 * http://couto.mit-license.org
 */(function(e){"use strict";function r(e){this.el=e,this.isOpen=!1,this.bindEvents()}function i(e){this.syntax=n[e.syntax],this.collapsed=e.collapsed||!1,this.collapsableCollection=[];if(!t.is.object(this.syntax))throw Error("Please pick a valid syntax. Possible values are: "+Object.keys(n).join(", "))}var t,n;t={$:function(e){return document.querySelectorAll(e)},$$:function(e,t){var n=document.createElement(e),r;t&&t.hasOwnProperty("html")&&(n.innerHTML=t.html,delete t.html);for(r in t)t.hasOwnProperty(r)&&n.setAttribute(r,t[r]);return n},bind:function(e){var t=Array.prototype.slice;return e&&typeof e=="function"?function(n,r){var i=t.call(arguments,2);return e.apply(n,[r].concat(i))}:function(e,n){var r=t.call(arguments,2);return function(){e.apply(n,r.concat(t.call(arguments)))}}}(Function.prototype.bind),keys:function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t);return n},forOwn:function(e,t,n,r){var i,s=n||this;for(i in e)e.hasOwnProperty(i)&&(r?setTimeout(this.bind(t,s,i,e[i],e),0):t.call(s,i,e[i],e));return e},forEach:function(e,t,n){var r=0,i=e.length,s=n||this;for(r;r<i;r+=1)t.call(s,e[r],r,e);return e},is:{_toString:function(e){return Object.prototype.toString.call(e)},object:function(e){return e&&this._toString(e)==="[object Object]"&&!this.falsy(e.isPrototypeOf)},array:function(e){return this._toString(e)==="[object Array]"},string:function(e){return this._toString(e)==="[object String]"},number:function(e){return this._toString(e)==="[object Number]"},falsy:function(e){return e===undefined||e===null||this.number(e)&&e!==+e||!e},punctuation:function(e){return this.string(e)&&/[{}\[\];(),.:]/g.test(e)},"boolean":function(e){return e===!0||e===!1||this._toString(e)==="[object Boolean]"},regex:function(e){return this._toString(e)==="[object RegExp]"},regexStr:function(e){return/(^|[^\/])\/(?!\/)(\[.+?\]|\\.|[^\/\r\n])+\/[gim]{0,3}(?=\s*($|[\r\n,.;})]))/g.test(e)},fun:function(e){return this._toString(e)==="[object Function]"}}},n={PrismJS:{tokenClass:"token",comment:"comment",string:"string",regex:"regex",keyword:"keyword","boolean":"boolean",number:"number",operator:"operator",ignore:null,punctuation:"punctuation"},Prettify:{string:"str",keyword:"kwd",comment:"com",type:"typ",literal:"lit",punctuation:"pun",plain:"pln",tag:"tag",declaration:"dec",source:"src",attribute_name:"atn",attribute_value:"atv",nocode:"nocode"}},r.prototype={constructor:r,open:function(){return this.isOpen||(this.addClass(),this.isOpen=!0,this.triggerEvent("opened")),this},close:function(){return this.isOpen&&(this.removeClass(),this.isOpen=!1,this.triggerEvent("closed")),this},toggle:function(e){return e&&e.stopPropagation(),this.isOpen?this.close():this.open()},addClass:function(){var e;return this.hasClass("opened")||(e=this.el.getAttribute("class"),this.el.setAttribute("class",e+" opened")),this},removeClass:function(){var e=this.el.getAttribute("class");return this.el.setAttribute("class",e.replace(/\sopened/g,"")),this},hasClass:function(e){return this.el.getAttribute("class")&&this.el.getAttribute("class").indexOf(e)!==-1},bindEvents:function(){this.el.addEventListener("click",t.bind(this.toggle,this))},unbindEvents:function(){this.el.removeEventListener("click",t.bind(this.toggle,this))},triggerEvent:function(e){var t=document.createEvent("MouseEvents");t.initMouseEvent(e,!0,!0),this.el.dispatchEvent(t)},dealloc:function(){this.unbindEvents(),this.el.parentNode.removeChild(this.el),delete this.el,delete this.isOpen}},i.prototype={constructor:i,convert:function(e,n){var i,s,o,u;return e=t.is.string(e)?JSON.parse(e):e,i=t.$$("ul",{"class":"callipygean"}),s=t.keys(e).length,o=n&&t.is.fun(n)?!0:!1,t.forOwn(e,function(e,a){s-=1,u=t.$$("li"),u.appendChild(this.buildKey(e)),t.is.object(a)?(u.appendChild(t.$$("span",{"class":this.syntax.tokenClass+" punctuation",html:"{"})),u.appendChild(this.buildObject(a)),u.appendChild(t.$$("span",{"class":this.syntax.tokenClass+" punctuation",html:"}"})),u.setAttribute("class","expandable object"),this.collapsableCollection.push(new r(u))):t.is.array(a)?(u.appendChild(t.$$("span",{"class":this.syntax.tokenClass+" punctuation",html:"["})),u.appendChild(this.buildArray(a)),u.appendChild(t.$$("span",{"class":this.syntax.tokenClass+" punctuation",html:"]"})),u.setAttribute("class","expandable array"),this.collapsableCollection.push(new r(u))):u.appendChild(this.buildStandard(a)),s&&u.appendChild(t.$$("span",{"class":this.syntax.tokenClass+" punctuation",html:","})),i.appendChild(u),o&&s===0&&n(i)},this,o),o?this:i},buildObject:function(e){var n,i,s=t.$$("ul",{"class":"object"}),o=t.keys(e).length;return t.forOwn(e,function(e,u){o-=1,n=t.$$("li"),i=this.buildKey(e),n.appendChild(i),t.is.array(u)?(n.appendChild(t.$$("span",{"class":this.syntax.tokenClass+" punctuation",html:"["})),n.appendChild(this.buildArray(u)),n.appendChild(t.$$("span",{"class":this.syntax.tokenClass+" punctuation",html:"]"})),n.setAttribute("class","expandable array"),this.collapsableCollection.push(new r(n))):t.is.object(u)?(n.appendChild(t.$$("span",{"class":this.syntax.tokenClass+" punctuation",html:"{"})),n.appendChild(this.buildObject(u)),n.appendChild(t.$$("span",{"class":this.syntax.tokenClass+" punctuation",html:"{"})),n.setAttribute("class","expandable object"),this.collapsableCollection.push(n)):n.appendChild(this.buildStandard(u)),o&&n.appendChild(t.$$("span",{"class":this.syntax.tokenClass+" punctuation",html:","})),s.appendChild(n)},this),s},buildArray:function(e){var n,i=t.$$("ul",{"class":"array"}),s=e.length;return t.forEach(e,function(e){s-=1,n=t.$$("li"),t.is.object(e)?(n.appendChild(t.$$("span",{"class":this.syntax.tokenClass+" punctuation",html:"{"})),n.appendChild(this.buildObject(e)),n.appendChild(t.$$("span",{"class":this.syntax.tokenClass+" punctuation",html:"}"})),n.setAttribute("class","expandable object")):t.is.array(e)?n=this.buildArray(e):n=this.buildStandard(e,"li"),s&&n.appendChild(t.$$("span",{"class":this.syntax.tokenClass+" punctuation",html:","})),i.appendChild(n),this.collapsableCollection.push(new r(n))},this),i},buildKey:function(e){return t.$$("span",{"class":"key "+this.syntax.tokenClass+" string",html:'"'+e+'":'})},buildStandard:function(e,n){var r=this.type(e);return console.log(e,r),t.$$(n||"span",{"class":this.syntax.tokenClass+" value "+r,html:r==="string"?'"'+e+'"':e})},convertAsync:function(){},type:function(e){var n=typeof e;if(n==="object"){if(t.is.array(e))return"array";if(t.is.regex(e))return"regex"}return n==="string"&&t.is.regexStr(e)?"regex":n},dealloc:function(){var e=this.collapsableCollection.length-1;for(e;e>=0;e-=1)this.collapsableCollection[e].dealloc()}},e.callipygean=function(e){return new i(e)}})(typeof exports=="object"&&exports||this);