/*jslint nomen:true, browser: true, white: true*//*global exports*//*!
 * callipygean
 * https://github.com/Couto/callipygean
 *
 * Copyright (c) 2012 Couto
 * Licensed under the MIT license.
 * http://couto.mit-license.org
 */(function(e){"use strict";function r(e){this.el=e,this.isOpen=!1,this.bindEvents()}function i(e){this.syntax=n[e.syntax],this.collapsed=e.collapsed||!1,this.collapsableCollection=[];if(!t.is.object(this.syntax))throw Error("Please pick a valid syntax. Possible values are: "+Object.keys(n).join(", "))}var t={$:function(e){return document.querySelectorAll(e)},$$:function(e,t){var n=document.createElement(e),r;t&&t.html&&(n.innerHTML=t.html,delete t.html);for(r in t)t.hasOwnProperty(r)&&n.setAttribute(r,t[r]);return n},bind:function(e){var t=Array.prototype.slice;return e&&typeof e=="function"?function(n,r){var i=t.call(arguments,2);return e.apply(n,[r].concat(i))}:function(e,n){var r=t.call(arguments,2);return function(){e.apply(n,r.concat(t.call(arguments)))}}}(Function.prototype.bind),is:{_toString:function(e){return Object.prototype.toString.call(e)},object:function(e){return e&&this._toString(e)==="[object Object]"&&!this.falsy(e.isPrototypeOf)},array:function(e){return this._toString(e)==="[object Array]"},string:function(e){return this._toString(e)==="[object String]"},number:function(e){return this._toString(e)==="[object Number]"},falsy:function(e){return e===undefined||e===null||this.number(e)&&e!==+e||!e},punctuation:function(e){return this.string(e)&&/[{}\[\];(),.:]/g.test(e)},"boolean":function(e){return e===!0||e===!1||this._toString(e)==="[object Boolean]"},regex:function(e){return this._toString(e)==="[object RegExp]"},regexStr:function(e){return/(^|[^/])\/(?!\/)(\[.+?]|\\.|[^/\r\n])+\/[gim]{0,3}(?=\s*($|[\r\n,.;})]))/g.test(e)},fun:function(e){return this._toString(e)==="[object Function]"}}},n={PrismJS:{tokenClass:"token",comment:"comment",string:"string",regex:"regex",keyword:"keyword","boolean":"boolean",number:"number",operator:"operator",ignore:null,punctuation:"punctuation"},Prettify:{string:"str",keyword:"kwd",comment:"com",type:"typ",literal:"lit",punctuation:"pun",plain:"pln",tag:"tag",declaration:"dec",source:"src",attribute_name:"atn",attribute_value:"atv",nocode:"nocode"}};r.prototype={constructor:r,open:function(){return this.isOpen||(this.addClass(),this.isOpen=!0,this.triggerEvent("opened")),this},close:function(){return this.isOpen&&(this.removeClass(),this.isOpen=!1,this.triggerEvent("closed")),this},toggle:function(){return this.isOpen?this.close():this.open()},addClass:function(){var e;return this.hasClass("opened")||(e=this.el.getAttribute("class"),this.el.setAttribute("class",e+" opened")),this},removeClass:function(){var e=this.el.getAttribute("class");return e.replace("opened",""),this.el.setAttribute("class",e),this},hasClass:function(e){return this.el.getAttribute("class").indexOf(e)!==-1},bindEvents:function(){this.el.addEventListener("click",t.bind(this.toggle,this))},unbindEvents:function(){this.el.removeEventListener("click",t.bind(this.toggle,this))},triggerEvent:function(e){var t=document.createEvent("MouseEvents");t.initMouseEvent(e,!0,!0),this.el.dispatchEvent(t)},dealloc:function(){this.unbindEvents(),this.el.parentNode.removeChild(this.el),delete this.el,delete this.isOpen}},i.prototype={constructor:i,convert:function(e,n){var i,s=this.syntax.tokenClass;return n&&t.is.fun(n)?this.convertAsync(e,n):(i=t.$$("ul",{"class":s+" expandable object"}),function o(e,n,i){var u,a,f,l,c;for(u in e)e.hasOwnProperty(u)&&(a=t.$$("li"),l=i.type(e[u]),t.is.object(e[u])?(f=t.$$("ul",{"class":s+" expandable object"}),o(e[u],f,i),a.appendChild(f),c=new r(f),i.collapsed?c.close():c.open(),i.collapsableCollection.push(c)):(a.appendChild(t.$$("span",{html:u,"class":s+" string attr"})),a.appendChild(t.$$("span",{html:e[u],"class":s+" "+l}))),n.appendChild(a))}(e,i,this),i)},convertAsync:function(){},type:function(e){var n=typeof e;if(n==="object"){if(t.is.array(e))return"array";if(t.is.regex(e))return"regex"}return n==="string"&&t.is.regexStr(e)?"regex":n},dealloc:function(){var e=this.collapsableCollection.length-1;for(e;e>=0;e-=1)this.collapsableCollection[e].dealloc()}},e.callipygean=function(e){return new i(e)}})(typeof exports=="object"&&exports||this);